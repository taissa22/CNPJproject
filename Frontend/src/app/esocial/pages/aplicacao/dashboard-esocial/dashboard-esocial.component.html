<app-container-pagina [titulo]="'Dashboard'" [caminho]="breadcrumb" [hasAdicionar]="false">


    <div class="action-bar d-flex mt-4 mb-2 mr-3">
        <div class="icons" [autoClose]="false" triggers="manual" #t="ngbTooltip" [ngbTooltip]="filtroDashboard" placement="bottom-left" tooltipClass="filtroDashboard" style="text-align: left" (click)="abrirFiltro(t)"><i class="fas fa-filter roxo-padrao"></i></div>
        <div *ngIf="qtdErros != 0" class="icons ml-3" [autoClose]="false" triggers="manual" #e="ngbTooltip" [ngbTooltip]="errosDashboard" placement="right" tooltipClass="errosDashboard" style="text-align: left" (click)="abrirFiltro(e)"><i class="fas fa-exclamation-circle red"></i></div>
        <div *ngIf="dashboard" class="sync-bar roxo-padrao ml-auto">Última atualização em {{dashboard.datUltimaAtualizacao | date:'MM/yyyy'}}, às {{dashboard.datUltimaAtualizacao | date:'HH:mm'}}
            <div class="sync ml-3" (click)="aplicar()"><i class=" fas fa-sync-alt "></i></div>
        </div>
    </div>

    <div class="grid-cards" *ngIf="dashboard">
        <div class="card-progress">
            <span class="roxo-padrao titulo-formularios">Situação Atual dos Formulários - {{dashboard.datPeriodoVigente}}</span>

            <div style="padding: 0px 20px">
                <sisjur-progress-bar [titulo]=" 'Pendentes' " [quantidadeRegistros]="dashboard.numTotPendentes" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="true " [corPercentual]=" '#ce666d' " [tamanhoConteudo]=" 'xl' "
                    [exibeDownload]="true
                    " [linkDownload]=" 'api/' "></sisjur-progress-bar>
            </div>

            <div class="box-progress">
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Transitados em julgado não analisádos' " [quantidadeRegistros]="dashboard.numTotPendNaoAnalisados" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" 'black' "
                        [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Elegíveis ainda não iniciados' " [quantidadeRegistros]="dashboard.numTotPendNaoIniciados" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" 'gray' "
                        [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Em rascunho escritório' " [quantidadeRegistros]="dashboard.numTotPendRascunhoEsc" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#6fbbfa' " [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Em rascunho contador' " [quantidadeRegistros]="dashboard.numTotPendRascunhoCont" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#6fbbfa' " [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Finalizados pendente de envio' " [quantidadeRegistros]="dashboard.numTotPendRascunhoEnv" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#6fbbfa' "
                        [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Retorno eSocial com crítica' " [quantidadeRegistros]="dashboard.numTotPendRetornoCritica" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#b1c40a' "
                        [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
            </div>
            <hr>
            <div style="padding: 0px 20px">
                <sisjur-progress-bar [titulo]=" 'Enviados' " [quantidadeRegistros]="dashboard.numTotEnviados" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="true " [corPercentual]=" '#66ce81' " [tamanhoConteudo]=" 'xl' "
                    [exibeDownload]="true
                    " [linkDownload]=" 'api/' "></sisjur-progress-bar>
            </div>
            <div class="box-progress">
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Retornados eSocial OK' " [quantidadeRegistros]="dashboard.numTotEnvRetornoOk" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#19a519' " [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Enviado FPW aguardando retorno' " [quantidadeRegistros]="dashboard.numTotEnvAguardRetorno" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#ff8c00' "
                        [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
                <div class="content-sm-progress">
                    <sisjur-progress-bar [titulo]=" 'Reconsultar no FPW' " [quantidadeRegistros]="dashboard.numTotEnvSemRecibo" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="false " [corPercentual]=" '#c77b38' " [tamanhoConteudo]=" 'sm'
                        " [exibeDownload]="false " [linkDownload]=" 'api/' "></sisjur-progress-bar>
                </div>
            </div>
            <hr>
            <div style="padding: 0px 20px">
                <sisjur-progress-bar [titulo]=" 'Retificados' " [quantidadeRegistros]="dashboard.numTotRetificados" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="true " [corPercentual]=" '#800040' " [tamanhoConteudo]=" 'xl' "
                    [exibeDownload]="true
                    " [linkDownload]=" 'api/' "></sisjur-progress-bar>
            </div>
            <div style="padding: 0px 20px">
                <sisjur-progress-bar [titulo]=" 'Excluidos 3500' " [quantidadeRegistros]="dashboard.numTotExcluidos" [quantidadeTotalRegistros]="dashboard.numTotGeral" [exibeQuantidade]="true " [exibePercentual]="true " [corPercentual]=" '#f25858' " [tamanhoConteudo]=" 'xl' "
                    [exibeDownload]="true
                    " [linkDownload]=" 'api/' "></sisjur-progress-bar>
            </div>



        </div>

        <div class="card-alerts">

            <div>
                <app-alerta-download [quantidade]="dashboard.numSlaNaoAnalisado" [titulo]=" 'reclamantes' " [status]=" 'não analisados' " [dias]="20 " [cor]=" 'gray' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaNaoIniciados" [titulo]=" 'formulários' " [status]=" 'elegíveis não iniciados' " [dias]="20 " [cor]=" 'gray' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaRascunhoEsc" [titulo]=" 'formulários' " [status]=" 'em rascunho com o escritório' " [dias]="20 " [cor]=" '#6fbbfa' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaRascunhoCon" [titulo]=" 'formulários' " [status]=" 'em rascunho com o contador' " [dias]="20 " [cor]=" '#6fbbfa' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaRascunhoEnv" [titulo]=" 'formulários' " [status]=" 'finalizado pendente de envio' " [dias]="20 " [cor]=" '#6fbbfa' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaAguardRetorno" [titulo]=" 'formulários' " [status]=" 'enviado FPW aguardando retorno' " [dias]="20 " [cor]=" '#ff8c00' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaRetornoCritica" [titulo]=" 'formulários' " [status]=" 'retornados eSocial com crítica' " [dias]="20 " [cor]=" '#b1c40a' " [linkDownload]=" '' "></app-alerta-download>
            </div>
            <div class="mt-3">
                <app-alerta-download [quantidade]="dashboard.numSlaSemRecibo" [titulo]=" 'formulários' " [status]=" 'reconsultar no FPW' " [dias]="20 " [cor]=" '#c77b38' " [linkDownload]=" '' "></app-alerta-download>
            </div>

        </div>
    </div>

    <div class="d-flex mt-3" *ngIf="dashboard">
        <div class=" btn-progress">
            <button type="button" class="btn btn-primary">Existem {{dashboard.numSlaVencidos}} formulários com SLA vencido! <i
                    class="fas fa-arrow-down ml-auto"></i></button>
        </div>
        <div class=" btn-alerts">
            <button type="button" class="btn btn-primary">Nenhum prazo vencendo no período vigente.<i
                    class="fas fa-arrow-down ml-auto"></i></button>
        </div>
    </div>

    <div class="grid-vazio" *ngIf="!dashboard">
        <span class="roxo-padrao">Nenhuma informação a ser exibida. Por favor, aguarde a próxima execução da rotina de consolidação dos dados.</span>
    </div>

    <ng-template #filtroDashboard>
        <div class="filter-box">
            <div class="UFs col mt-4">
                <span class="mr-2 card-label"><b>UF:</b></span>
                <ng-select id="uf" #selectUf [items]="ufList" bindValue="id" bindLabel="id" notFoundText="Nenhuma opção disponível" [closeOnSelect]="false" placement="bottom" [searchable]="true" [clearable]="true" [multiple]="true" [formControl]="ufFormControl" placeholder="Selecione uma UF">
                    <ng-template ng-option-tmp let-item="item">
                        <div title="{{ item.descricaoConcat }}">
                            {{ item.descricaoConcat }}
                        </div>
                    </ng-template>
                </ng-select>
            </div>
            <div class="empresas col mt-3">
                <span class="mr-2 card-label"><b>Empresa:</b></span>
                <ng-select id="empresa" [items]="empresaLista" bindValue="id" bindLabel="descricao" notFoundText="Nenhuma opção disponível" [closeOnSelect]="false" placement="bottom" [searchable]="true" [clearable]="true" [multiple]="true" [formControl]="empresaFormControl"
                    placeholder="Selecione uma empresa">
                </ng-select>
            </div>
            <div class="actions-filter">
                <button type="button" class="btn btn-link mr-auto pl-0" aria-label="Close" (click)="limparFiltros()">
                    Limpar filtros
                </button>
                <button type="button" class="btn btn-link" aria-label="Close" (click)="close(t)">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" (click)="aplicar()">
                    Aplicar
                </button>
            </div>
        </div>
    </ng-template>

    <ng-template #errosDashboard>
        <div class="filter-box">
            <span>Existe(m) <span class="red">{{qtdErros}} formulário(s)</span> com erro no envio para o FPW</span>
        </div>
    </ng-template>



</app-container-pagina>